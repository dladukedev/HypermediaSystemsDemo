@model ContactListViewModel
@{
ViewData["Title"] = "Contacts";
}

<style>
  tr.htmx-swapping {
    opacity: 0;
    transition: opacity 1s ease-out;
  }
</style>

<h1>Contacts</h1>

@if (TempData["SuccessMessage"] != null)
{
<article>
  @TempData["SuccessMessage"]
</article>
}

@await Html.PartialAsync("./Archive.cshtml", Model.Archiver)

<form role="search" action="/Contacts" method="get">
  <input id="search" placeholder="Search" _="on keydown[altKey and code is 'KeyS'] from the window focus() me"
    type="search" name="q" hx-get="/contacts" hx-push-url="true" hx-indicator="#spinner"
    hx-trigger="search, keyup delay:200ms changed" hx-target="tbody" value="@(Model.SearchTerm ?? "")" />

  <input type="submit" value="Search" />
</form>
<article id="spinner" class="htmx-indicator" aria-busy="true"></article>

<form x-data="{ selected: [] }">
  <template x-if="selected.length > 0">
    <div tool-bar>
      <slot x-text="selected.length"></slot>
      contacts selected

      <button type="button"
        @@click="confirm(`Delete ${selected.length} contacts?`) && htmx.ajax('DELETE', '/Contacts/BulkDelete', {source:$root, target: document.body })">Delete</button>
      <button type="button" @@click="selected = []">Cancel</button>
    </div>
  </template>

  <table>
    <thead>
      <tr>
        <th />
        <th>First</th>
        <th>Last</th>
        <th>Phone</th>
        <th>Email</th>
        <th />
      </tr>
    </thead>

    @await Html.PartialAsync("./ContactList.cshtml", Model)

  </table>

  <button hx-delete="/Contacts/BulkDelete" hx-confirm="Are you sure you want to delete these contacts?" hx-target="body"
    hx-swap="innerHTML show:window:top">Delete Selected Contacts</button>
</form>

<p>
  <a href="/Contacts/new">Add Contact</a>
  <span hx-get="/Contacts/Count" hx-trigger="revealed">
    <span aria-busy="true" class="htmx-indicator" />
  </span>
</p>
